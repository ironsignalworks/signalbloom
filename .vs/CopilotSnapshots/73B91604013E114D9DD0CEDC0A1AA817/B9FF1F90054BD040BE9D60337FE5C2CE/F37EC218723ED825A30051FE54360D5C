import { MicAnalyser } from './audio';
import { BloomScene } from './scene';

const canvas = document.getElementById('stage') as HTMLCanvasElement;
const startBtn = document.getElementById('start') as HTMLButtonElement;
const gainEl = document.getElementById('gain') as HTMLInputElement;

const audio = new MicAnalyser();
const app = new BloomScene(canvas);

let running = false;

startBtn.addEventListener('click', async () => {
  try {
    await audio.init();
    running = true;
    startBtn.disabled = true;
  } catch (e) {
    alert('Microphone permissions are required for audio-reactive mode.\nFalling back to idle animation.');
    running = true; // still run visual
    startBtn.disabled = true;
  }
});

gainEl.addEventListener('input', () => {
  audio.gain = parseFloat(gainEl.value);
});

function loop() {
  const lvl = running ? audio.level() : 0.0;
  app.update(lvl);
  requestAnimationFrame(loop);
}
loop();
// JavaScript source code
